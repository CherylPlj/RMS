@{
    ViewData["Title"] = "Cozy Homes - Tenants";
    Layout = "~/Views/Shared/_LayoutPM.cshtml";
}
<head>

<style>


      
        /* Table Styling */
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
            text-align: left;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 16px;
        }


        th {
            background-color: #b0836e;
            color: white;
            font-weight: bold;
        }
        /* Buttons */
        .button-container {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
            padding-left: 60%;
            margin-top: 35px;
            /* width: auto; */
        }

        .pagination-btn {
            background-color: transparent;
            color: #B0836E;
            border: 2px solid #B0836E;
            padding: 7px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Poppins';
            width: 10%;
        }

            .pagination-btn:hover {
                background-color: #7c4e39;
                color: #fff;
                border-color: #7c4e39;
            }

        .invoice-button, .pay-button {
            white-space: nowrap;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 85%;
            font-family: 'Poppins';
            font-size: 16px;
        }

        .invoice-button {
            background-color: transparent;
            color: #B0836E;
            border: 2px solid #B0836E;
        }

        .pay-button {
            background-color: #B0836E;
            color: #fff;
            border: none;
        }

            .pay-button:hover, .invoice-button:hover {
                background-color: #7c4e39;
                color: #fff;
                border-color: #7c4e39;
            }

    </style>

</head>
<div class="tenants-page">
    <h2>Tenants Management</h2>
    <button asp-controller="PropertyManager" asp-action="AddTenant" class="btn btn-primary">Add New Tenant</button>
    <button class="btn btn-secondary" onclick="exportToCSV()">Export to CSV</button>
    <button class="btn btn-secondary" onclick="exportToPDF()">Export to PDF</button>
    <input type="text" id="tenantSearch" placeholder="Search tenants..." class="form-control" />

    <table class="tenants-table">
        <thead>
            <tr>
                <th>Tenant Name</th>
                <th>Unit Number</th>
                <th>Contact Info</th>
                <th>Lease Start Date</th>
                <th>Lease End Date</th>
                <th>Monthly Rent</th>
                <th>Outstanding Balance</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>John Doe</td>
                <td>101</td>
                <td>(555) 123-4567</td>
                <td>01/01/2024</td>
                <td>12/31/2024</td>
                <td>$1,200</td>
                <td>$0</td>
                <td>Active</td>
                <td>
                    <a asp-controller="PropertyManager" asp-action="ViewTenant" asp-route-id="1" class="pagination-btn">View</a>
                    <a asp-controller="PropertyManager" asp-action="EditTenant" asp-route-id="1" class="pagination-btn">Edit</a>
                    <a asp-controller="PropertyManager" asp-action="DeleteTenant" asp-route-id="1" class="pagination-btn" onclick="return confirm('Are you sure?')">Delete</a>
                </td>
            </tr>
            <!-- Add more rows dynamically -->
        </tbody>
    </table>
</div>

<!-- Modal structure -->
<div class="modal" id="tenantModal" tabindex="-1" aria-labelledby="tenantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tenantModalLabel">Tenant Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="tenantDetails">Loading...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Tenant Modal -->
<!-- Modal Code (same as above) -->
<!-- Button to trigger modal -->
<button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTenantModal">
    Add Tenant
</button>

<!-- Table -->
<table class="tenants-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Unit</th>
            <th>Lease Start</th>
            <th>Lease End</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        <!-- Existing tenant rows -->
    </tbody>
</table>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>



<!-- Script to load tenant details -->
<script>
    function viewTenantDetails(tenantId) {
        fetch(`/PropertyManager/ViewTenantDetails/${tenantId}`)
            .then(response => response.json())
            .then(data => {
                const details = `
                    <strong>Name:</strong> ${data.name}<br>
                    <strong>Unit:</strong> ${data.unit}<br>
                    <strong>Lease Start:</strong> ${data.leaseStartDate}<br>
                    <strong>Lease End:</strong> ${data.leaseEndDate}<br>
                    <strong>Status:</strong> ${data.status}
                `;
                document.getElementById('tenantDetails').innerHTML = details;
                const modal = new bootstrap.Modal(document.getElementById('tenantModal'));
                modal.show();
            })
            .catch(error => console.error('Error loading tenant details:', error));
    }
</script>


<script>

   function exportToCSV() {
    const table = document.querySelector('.tenants-table');
    const rows = Array.from(table.rows);
    
    const csvContent = rows.map(row => {
        const cells = Array.from(row.cells).map(cell => cell.innerText);
        return cells.join(',');
    }).join('\n');
    
    const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const downloadLink = document.createElement('a');
    downloadLink.href = URL.createObjectURL(csvBlob);
    downloadLink.download = 'tenants.csv';
    downloadLink.click();
}


   function exportToPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    const table = document.querySelector('.tenants-table'); // Target the tenants table

    // Convert table to an array of rows and columns for jsPDF autoTable
    const rows = Array.from(table.rows).map(row => {
        return Array.from(row.cells).map(cell => cell.innerText); // Extract text from each cell
    });

    // Prepare the table data for jsPDF's autoTable method
    const headers = rows.shift(); // Remove the first row (headers)

    doc.autoTable({
        head: [headers], // Table headers
        body: rows, // Table rows
        startY: 20, // Adjust to position the table on the page
        margin: { horizontal: 10 }, // Add margin around the table
    });

    // Save the generated PDF
    doc.save('tenants.pdf');
}

        document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById('tenantSearch');
        const table = document.querySelector('.tenants-table');

        searchInput.addEventListener('keyup', function () {
            const query = searchInput.value.toLowerCase();
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const columns = row.querySelectorAll('td');
                const tenantName = columns[0].innerText.toLowerCase(); // Assuming name is in the first column

                if (tenantName.includes(query)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    });


</script>